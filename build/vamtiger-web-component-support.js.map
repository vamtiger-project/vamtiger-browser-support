{"version":3,"file":"vamtiger-web-component-support.js","sources":["../node_modules/vamtiger-browser-method/source/types.ts","../node_modules/vamtiger-browser-method/source/load-script.ts","../source/vamtiger-web-component-support.ts"],"sourcesContent":["import * as tslib from '../node_modules/tslib/tslib';\nimport defineCustomElement from './define-custom-element';\n\nexport enum ScriptType {\n    jsonld = 'application/ld+json'\n}\n\nexport enum ScriptAttribute {\n    type = 'type'\n}\n\nexport enum ErrorMessage {\n    failedToLoadScript = 'Failed to load script',\n    windowPropertyNotSet = 'Window property not set',\n    unsupportedFeature = 'Unsupported feature',\n    customElementAreadyDefined = 'Custom element already defined'\n}\n\nexport enum StringConstant {\n    slash = '/'\n}\n\nexport enum LinkRel {\n    stylesheet = 'stylesheet'\n}\n\nexport enum LoadScriptElement {\n    script = 'script',\n    link = 'link',\n    style = 'style'\n}\n\nexport enum Selector {\n    lastStylesheet = 'style:last-of-type',\n    webcomponentsjs = 'script[src*=\"@webcomponents\\/webcomponentsjs\"]'\n}\n\nexport interface ILoadRemoteScriptParams {\n    src: string;\n}\n\nexport interface ILoadRemoteStylesheetScriptParams {\n    href: string;\n}\n\nexport interface ILoadLocalScriptParams {\n    name: string;\n}\n\nexport interface ILoadScriptParams {\n    js: string;\n    jsonld?: boolean;\n}\n\nexport interface ILoadStylesheetScriptParams {\n    css: string;\n}\n\nexport interface ILoadScript {\n    params: LocalScriptParams\n        | LocalStylesheetScriptParams\n        | ILoadRemoteScriptParams\n        | ILoadRemoteStylesheetScriptParams;\n    reject: (error: Error) => void\n}\n\nexport interface ILoadShadowStylesheet {\n    css: string;\n    element: HTMLElement;\n}\n\nexport interface IDefineCustomElement {\n    name: string;\n    constructor: {\n        new (): HTMLElement\n        prototype: HTMLElement;\n    };\n    ignore?: boolean;\n}\n\nexport interface IPause {\n    milliseconds: number;\n}\n\nexport type TsLibType = typeof tslib;\n\nexport type TsLibKey = keyof TsLibType;\n\nexport type TsLib = {\n    [K in TsLibKey]: TsLibType[K]\n}\n\nexport type LocalScriptParams = ILoadLocalScriptParams & ILoadScriptParams;\n\nexport type LocalStylesheetScriptParams = ILoadLocalScriptParams & ILoadStylesheetScriptParams;\n\nexport type LoadedScript<P extends ILoadScript['params']> =\n    P extends ILoadScriptParams ? HTMLScriptElement :\n    P extends ILoadStylesheetScriptParams ? HTMLStyleElement :\n    P extends ILoadRemoteScriptParams ? HTMLScriptElement :\n    P extends ILoadRemoteStylesheetScriptParams ? HTMLLinkElement :\n    never;\n\ndeclare global {\n    interface Window extends TsLib {\n        VamtigerBrowserMethod: {\n            loadScript: <P extends ILoadScript['params']>(params: P) => Promise<LoadedScript<P>>;\n            defineCustomElement: (params: IDefineCustomElement) => void;\n        }\n    }\n\n    namespace NodeJS {\n        interface  Global {\n            VamtigerBrowserMethod: Window['VamtigerBrowserMethod'];\n        }\n    }\n}","import {\n    ILoadScript,\n    ErrorMessage,\n    LocalScriptParams,\n    LocalStylesheetScriptParams,\n    ILoadRemoteStylesheetScriptParams,\n    ILoadRemoteScriptParams,\n    LoadScriptElement,\n    LoadedScript,\n    LinkRel,\n    ScriptAttribute,\n    ScriptType\n} from './types';\n\nconst { failedToLoadScript } = ErrorMessage;\nconst { stylesheet } = LinkRel;\nconst { script: scriptElement, link, style } = LoadScriptElement;\n\nexport default <P extends ILoadScript['params']>(params: P) => new Promise((resolve: (script: LoadedScript<P>) => void, reject: ILoadScript['reject']) => {\n    const { head, body } = document;\n    const { js, name: scriptName, jsonld } = params as LocalScriptParams;\n    const { src } = params as ILoadRemoteScriptParams;\n    const { css, name: stylesheetName } = params as LocalStylesheetScriptParams;\n    const { href } = params as ILoadRemoteStylesheetScriptParams;\n    const remoteScript = params.hasOwnProperty('src') || params.hasOwnProperty('href');\n    const element = (js || src) && scriptElement\n        || css && style\n        || href && link;\n    const selector = src && `script[src=\"${src}\"]`\n        || href && `link[href=\"${href}\"]`\n        || js && scriptName && `script[data-name=\"${scriptName}\"]`\n        || css && stylesheetName && `style[data-name=\"${stylesheetName}\"]`;\n    const existingScript = (head.querySelector(selector) || body.querySelector(selector)) as LoadedScript<P>;\n    const script = selector\n        && element\n        && document.createElement(element) as LoadedScript<P>;\n\n    if (script instanceof HTMLScriptElement) {\n        if (src) {\n            script.src = src;\n        } else if (js) {\n            script.innerHTML = js;\n            script.dataset.name = scriptName;\n\n            if (jsonld) {\n                script.setAttribute(ScriptAttribute.type, ScriptType.jsonld);\n            }\n        }\n    } else if (script instanceof HTMLLinkElement) {\n        script.rel = stylesheet;\n        script.href = href;\n    } else if (script instanceof HTMLStyleElement) {\n        script.innerHTML = css;\n        script.dataset.name = stylesheetName;\n    }\n\n    if (existingScript) {\n        resolve(existingScript);\n    } else if (script) {\n        head.appendChild(script);\n\n        if (remoteScript) {\n            script.addEventListener('load', handleLoad);\n            script.addEventListener('error', handleLoadError);\n        } else {\n            resolve(script);\n        }\n    }\n\n    function handleLoad(event: Event) {\n        if (script) {\n            script.removeEventListener('load', handleLoad);\n\n            resolve(script);\n        }\n    }\n\n    function handleLoadError(event: Event) {\n        if (script) {\n            script.removeEventListener('error', handleLoadError);\n        }\n\n        console.error(event);\n\n        reject(new Error(`${failedToLoadScript}`));\n    }\n});","import { IUpdateBrowserSupport } from './types';\nimport loadScript from '../node_modules/vamtiger-browser-method/source/load-script';\nimport pause from '../node_modules/vamtiger-browser-method/source/pause';\n\nconst { VamtigerBrowserSupport } = window;\nconst supportFile = 'vamtiger-web-component-support';\nconst polyfill = 'https://unpkg.com/@webcomponents/webcomponentsjs';\nconst params = {\n    supportFile\n} as IUpdateBrowserSupport;\nconst webComponent = `\nconst shadowDomTemplate = document.createElement('template');\n\nshadowDomTemplate.innerHTML = \\`\n<style>\n    .container {\n        border: 1px solid red;\n    }\n</style>\n\n<div class=\"container\">\n    <slot name=\"test-slot-1\"></slot>\n    <span>\n            VAMTIGER Browser Support\n    </span>\n    <slot name=\"test-slot-2\"></slot>\n</div>\n\\`\n\nclass VamtigerWebComponentSupport extends HTMLElement {\n    static get observedAttributes() {\n        const observedAttributes = [\n            'data-${supportFile}'\n        ];\n\n        return observedAttributes;\n    }\n\n    constructor() {\n        super();\n        const template = shadowDomTemplate.content.cloneNode(true);\n        const shadowRoot = this.attachShadow({mode: 'open'});\n\n        shadowRoot.appendChild(template);\n    }\n\n    connectedCallback() {\n        this.dataset['vamtigerWebComponentSupportConnectedCallback'] = '';\n    }\n\n    disconnectedCallback() {\n        this.dataset['vamtigerWebComponentSupportDisconnectedCallback'] = '';\n    }\n\n    attributeChangedCallback(attrName, oldValue, newValue) {\n        this.dataset['vamtigerWebComponentSupportOldValue'] = oldValue;\n        this.dataset['vamtigerWebComponentSupportNewValue'] = newValue;\n\n        this.dataset['vamtigerWebComponentSupportAttributeChangedCallback'] = '';\n    }\n}\n\ncustomElements.define('${supportFile}', VamtigerWebComponentSupport);\n`;\n\nfunction test() {\n    const { body } = document;\n    const customElement = document.createElement(supportFile);\n\n    let result = false;\n\n    customElement.innerHTML = `\n        <span slot=\"test-slot-1\">\n            Test Slot 1\n        </span>\n        <span>\n            No slot defined\n        </span>\n\n        <span slot=\"test-slot-2\">\n            Test Slot 2\n        </span>\n    `;\n\n    customElement.dataset['vamtigerWebComponentSupport'] = 'old-value';\n\n    body.appendChild(customElement);\n\n    customElement.dataset['vamtigerWebComponentSupport'] = 'new-value';\n\n    body.removeChild(customElement);\n\n    result = customElement.dataset.hasOwnProperty('vamtigerWebComponentSupportConnectedCallback')\n        && customElement.dataset.hasOwnProperty('vamtigerWebComponentSupportDisconnectedCallback')\n        && customElement.dataset['vamtigerWebComponentSupportOldValue'] === 'old-value'\n        && customElement.dataset['vamtigerWebComponentSupportNewValue'] === customElement.dataset['vamtigerWebComponentSupport']\n        && customElement.shadowRoot.children.length === 2\n        && window.hasOwnProperty('HTMLTemplateElement')\n        && window.hasOwnProperty('HTMLSlotElement')\n        && !!HTMLElement.prototype.attachShadow;\n\n    return result;\n}\n\ntry {\n    eval(webComponent);\n\n    params.supported = test();\n} catch(error) {\n    params.error = error;\n}\n\nif (!params.supported) {\n    params.polyfill = polyfill;\n\n    loadScript({ src: params.polyfill})\n        .then(() => console.log({'window.customElements.define': window.customElements.define}))\n        .then(() => VamtigerBrowserSupport(params));\n} else {\n    VamtigerBrowserSupport(params);\n}"],"names":["ScriptType","ScriptAttribute","ErrorMessage","StringConstant","LinkRel","LoadScriptElement","Selector","failedToLoadScript","stylesheet","scriptElement","link","style","params","Promise","resolve","reject","head","body","_a","js","scriptName","jsonld","src","_b","css","stylesheetName","href","remoteScript","hasOwnProperty","element","selector","existingScript","querySelector","script","document","createElement","HTMLScriptElement","innerHTML","dataset","name","setAttribute","type","HTMLLinkElement","rel","HTMLStyleElement","appendChild","addEventListener","handleLoad","event","removeEventListener","handleLoadError","console","error","Error","VamtigerBrowserSupport","supportFile","polyfill","webComponent","test","customElement","removeChild","shadowRoot","children","length","window","HTMLElement","prototype","attachShadow","eval","supported","loadScript","then","log","window.customElements.define","customElements","define"],"mappings":"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"}