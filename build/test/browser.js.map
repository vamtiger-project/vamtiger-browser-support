{"version":3,"file":"browser.js","sources":["../../source/types.ts","../../source/test/meta-element.ts","../../source/test/browser-support.ts","../../source/test/browser.ts"],"sourcesContent":["import * as VamtigerBrowserMethodTypes from 'vamtiger-browser-method/build/types';\nimport * as AWS from 'aws-sdk';\n\nexport enum StringConstant {\n    nothing = '',\n    build = 'build',\n    vamtiger = 'vamtiger',\n    slash = '/',\n    jsExtension = '.js',\n    bashAnd = '&&',\n    arn = 'arn',\n    sns = 'sns',\n    aws = 'aws',\n    colon = ':',\n    hyphen = '-',\n    'vamtiger-contact' = 'vamtiger-contact',\n    '5e5164d3' = '5e5164d3',\n    cc71 = 'cc71',\n    '4e5b' = '4e5b',\n    '9c34' = '9c34',\n    '042fe735f31c' = '042fe735f31c'\n}\n\nexport enum Region {\n    usWest2= 'us-west-2'\n}\n\nexport enum ElmentName {\n    meta = 'meta',\n    script = 'script'\n}\n\nexport enum ElementId {\n    vamtigerBrowserSupport = 'vamtiger-browser-support'\n}\n\nexport enum ElementAttribute {\n    id = 'id'\n}\n\nexport enum MetaElementAttribute {\n    baseUrl = 'baseUrl',\n    name = 'name',\n    url = 'url',\n    primary = 'primary',\n    loaded = 'loaded',\n    supported = 'supported',\n    unsupported = 'unsupported',\n    error = 'error',\n    polyfill = 'polyfill',\n    loadCritical = 'loadCritical',\n    load = 'load',\n    wait = 'wait'\n}\n\nexport enum MetaElementBrowserSupportAttribute {\n    botSupport = 'data-bot-support',\n    es2015Support = 'data-es2015-support',\n    elementQuerySupport = 'data-element-query-support',\n    webComponentSupport = 'data-web-component-support',\n    fetchSupport = 'data-fetch-support',\n    awsSupport = 'data-aws-support',\n    contactSupport = 'data-contact-support'\n}\n\nexport enum Selector {\n    vamtigerBrowserSupportScript = 'script[src*=\"vamtiger-browser-support\"]',\n    vamtigerBrowserMethodJsonJs = '[src$=\"vamtiger-browser-method.js.json.js\"]',\n    vamtigerBrowserMethodJson = '[data-name$=\"vamtiger-browser-method.js.json\"]'\n}\n\nexport enum ScriptUrl {\n    vamtigerBrowserMethod = 'https://vamtiger-project.github.io/vamtiger-browser-method/build/vamtiger-browser-method.js',\n    vamtigerBrowserMethodJsonJs = 'https://vamtiger-project.github.io/vamtiger-browser-method/build/vamtiger-browser-method.js.json.js'\n}\n\nexport enum ErrorMessage {\n    notBrowser = 'This is not a web browser',\n    noFormForSelector = 'No Form for Selector',\n    noFieldInFormForSelector = 'No Field in Form for Selector'\n}\n\nexport enum NpmScript {\n    bundleSource = 'bundle-source'\n}\n\nexport enum SupportType {\n    primary = 'primary',\n    secondary = 'secondary'\n}\n\nexport enum LoadOnComplete {\n    loadCritical = 'loadCritical',\n    load = 'load'\n}\n\nexport enum VamtigerFormDataSupportFormFieldValue {\n    innerHTML = 'innerHTML'\n}\n\nexport enum DocumentDataAttribute {\n    touchSupport = 'vamtigerTouchSupport'\n}\n\nexport enum SupportFile {\n    elementQuery = 'vamtiger-element-query-support'\n}\n\nexport enum Polyfill {\n    elementQuery = 'https://cdn.jsdelivr.net/npm/eqcss@latest/EQCSS.min.js'\n}\n\nexport type LoadOnCompleteType  = keyof typeof LoadOnComplete;\n\nexport type Support = keyof typeof MetaElementBrowserSupportAttribute;\n\nexport type SupportTypeKey = keyof typeof SupportType;\n\nexport type StringObject = {[key: string]: string};\n\nexport type AnyObject = {[key: string]: any};\n\nexport type VamtigerSupportFile = 'vamtiger-es2015-support';\n\nexport type VamtigerFormDataSupportFormFieldValueKey = keyof typeof VamtigerFormDataSupportFormFieldValue;\n\nexport type VamtigerSupport =  {\n    [K in VamtigerSupportFile]?: IUpdateBrowserSupport;\n}\n\nexport type VamtigerContactResolve = (response: AWS.SNS.PublishResponse) => void;\n\nexport type VamtigerContactReject = (error: AWS.AWSError) => void;\n\nexport interface ISetBrowserSupportMetaElement {\n    support: Support;\n    primary?: boolean;\n}\n\nexport interface IUpdateBrowserSupport {\n    supportFile: string;\n    supported?: boolean;\n    polyfill?: string;\n    polyfills?: string[];\n    polyfillChain?: string[][]\n    wait?: boolean;\n    error?: string;\n}\n\nexport interface IUpdateBrowserSupportLoadScripts {\n    polyfills: IUpdateBrowserSupport['polyfills'];\n}\n\nexport interface IGetSupportUrls {\n    supportType: SupportType;\n}\n\nexport interface ILoadNextSupport {\n    supportType: SupportType;\n}\n\nexport interface IVamtigerContactParams {\n    template: string;\n    subject: string;\n    origin: string;\n}\n\nexport interface IVamtigerFormSupport {\n    form: string;\n    field?: IVamtigerFormSupportFormField;\n}\n\nexport interface IVamtigerFormSupportFormField {\n    selector: string;\n    name: string;\n    value?: VamtigerFormDataSupportFormFieldValueKey;\n}\n\ndeclare global {\n    interface Window extends VamtigerSupport {\n        [ElementId.vamtigerBrowserSupport]: HTMLMetaElement,\n        VamtigerBrowserSupport: (params: IUpdateBrowserSupport) => void;\n        VamtigerContact: (params: IVamtigerContactParams) => Promise<AWS.SNS.PublishResponse>;\n        _VamtigerContact_: (params: any) => void;\n        VamtigerForm: (params: IVamtigerFormSupport) => Promise<AnyObject>;\n        AWS: typeof AWS;\n    }\n}\n\nexport const supportTypes = Object.keys(SupportType) as SupportType[];\n\nexport const regex = {\n    leadingData: /^data/,\n    trailingSupport: /(.*?Support)(Primary)?$/,\n    supportScript: /vamtiger(-\\w+)+-(support|polyfill)/,\n    distTag: /(\\d|latest)$/,\n    bot: /bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex/i\n}\n\nexport const stringConstant = {\n    ...StringConstant,\n    365080655670: 365080655670\n};\n\nexport const selector = {\n    vamtigerBrowserMethod: `script[src=\"${ScriptUrl.vamtigerBrowserMethod}\"]`\n}","import { expect } from 'chai';\nimport { ElementId } from '../types';\n\nconst { vamtigerBrowserSupport: vamtigerBrowserSupportId } = ElementId;\n\nexport default () => describe('Meta Element', function () {\n    it('Added to document head', async function () {\n        const vamtigerBrowserSupport = document.head.querySelector(`[id=${vamtigerBrowserSupportId}]`);\n\n        expect(vamtigerBrowserSupport).to.be.ok;\n    });\n});","import { expect } from 'chai';\nimport { ElementId, StringConstant } from '../types';\n\nconst { slash } = StringConstant;\nconst { vamtigerBrowserSupport: vamtigerBrowserSupportId } = ElementId;\nconst { [vamtigerBrowserSupportId]: vamtigerBrowserSupport } = window;\nconst metaElements = Array\n    .from(vamtigerBrowserSupport.children)\n    .sort() as HTMLMetaElement[];\nconst category = {\n    supported: [] as string[],\n    unsupported: [] as string[]\n};\nconst categories = Object.keys(category).sort() as (keyof typeof category)[];\n\nexport default () => describe('Browser Support Scripts', function () {\n    metaElements.forEach(metaElement => {\n        const { dataset: data } = metaElement;\n        const { url } = data;\n        const urlPaths = url.split(slash);\n        const script = urlPaths[urlPaths.length - 1];\n        const result = metaElement.dataset.hasOwnProperty('supported') && 'supported' || 'unsupported';\n\n        category[result].push(script);\n    });\n\n    categories.forEach(currentCategory => describe(currentCategory, function () {\n        category[currentCategory].forEach(script => it(script, function () {\n            expect(script).to.be.ok;\n        }));\n    }));\n});","import { setup, run } from 'mocha';\nimport metaElement from './meta-element';\nimport browserSupport from './browser-support';\n\nconst tests = [\n    metaElement,\n    browserSupport\n];\n\nsetup('bdd');\n\ntests.forEach(test => test());\n\nrun();"],"names":["StringConstant","Region","ElmentName","ElementId","ElementAttribute","MetaElementAttribute","MetaElementBrowserSupportAttribute","Selector","ScriptUrl","ErrorMessage","NpmScript","SupportType","LoadOnComplete","VamtigerFormDataSupportFormFieldValue","DocumentDataAttribute","SupportFile","Polyfill","365080655670","vamtigerBrowserMethod","vamtigerBrowserSupportId","slash","vamtigerBrowserSupport","metaElements","Array","from","children","sort","category","supported","unsupported","categories","Object","keys","tests","describe","it","document","head","querySelector","expect","to","be","ok","forEach","metaElement","urlPaths","split","script","length","result","dataset","hasOwnProperty","push","currentCategory","setup","test","run"],"mappings":"iMAGA,IAAYA,EAoBAC,EAIAC,EAKAC,EAIAC,EAIAC,EAeAC,EAUAC,EAMAC,EAKAC,EAMAC,EAIAC,EAKAC,EAKAC,EAIAC,EAIAC,EAIAC,GAzGZ,SAAYhB,GACRA,aACAA,gBACAA,sBACAA,YACAA,oBACAA,eACAA,YACAA,YACAA,YACAA,YACAA,aACAA,yCACAA,yBACAA,cACAA,iBACAA,iBACAA,iCAjBJ,CAAYA,IAAAA,OAoBZ,SAAYC,GACRA,sBADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,cACAA,kBAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,oDADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,UADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,oBACAA,cACAA,YACAA,oBACAA,kBACAA,wBACAA,4BACAA,gBACAA,sBACAA,8BACAA,cACAA,cAZJ,CAAYA,IAAAA,OAeZ,SAAYC,GACRA,gCACAA,sCACAA,mDACAA,mDACAA,oCACAA,gCACAA,wCAPJ,CAAYA,IAAAA,OAUZ,SAAYC,GACRA,yEACAA,4EACAA,6EAHJ,CAAYA,IAAAA,OAMZ,SAAYC,GACRA,sHACAA,oIAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,yCACAA,2CACAA,2DAHJ,CAAYA,IAAAA,OAMZ,SAAYC,GACRA,+BADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,oBACAA,wBAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,8BACAA,cAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,wBADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,sCADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,gDADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,wEADJ,CAAYA,IAAAA,YA4FLhB,GACHiB,aAAc,eAIwBT,EAAUU,sBAhBpD,IC1LQC,2BCAAC,UACAD,2BACAE,YACFC,EAAeC,MAChBC,KAAKH,EAAuBI,UAC5BC,OACCC,GACFC,aACAC,gBAEEC,EAAaC,OAAOC,KAAKL,GAAUD,OCTnCO,cFCe,OAAAC,SAAS,eAAgB,WAC1CC,GAAG,yBAA0B,gGACnBd,EAAyBe,SAASC,KAAKC,cAAc,OAAOnB,OAElEoB,SAAOlB,GAAwBmB,GAAGC,GAAGC,oRCMxB,OAAAR,SAAS,0BAA2B,WACrDZ,EAAaqB,QAAQ,SAAAC,GACT,IAEFC,gBAAeC,MAAM1B,GACrB2B,EAASF,EAASA,EAASG,OAAS,GACpCC,EAASL,EAAYM,QAAQC,eAAe,aAAgB,YAAe,cAEjFxB,EAASsB,GAAQG,KAAKL,KAG1BjB,EAAWa,QAAQ,SAAAU,GAAmB,OAAAnB,SAASmB,EAAiB,WAC5D1B,EAAS0B,GAAiBV,QAAQ,SAAAI,GAAU,OAAAZ,GAAGY,EAAQ,WACnDR,SAAOQ,GAAQP,GAAGC,GAAGC,eCnBjCY,QAAM,OAENrB,EAAMU,QAAQ,SAAAY,GAAQ,OAAAA,MAEtBC"}