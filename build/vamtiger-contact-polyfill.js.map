{"version":3,"file":"vamtiger-contact-polyfill.js","sources":["../source/types.ts","../source/config.ts","../source/vamtiger-contact-polyfill.ts"],"sourcesContent":["import * as VamtigerBrowserMethodTypes from 'vamtiger-browser-method/build/types';\nimport * as AWS from 'aws-sdk';\n\nexport enum StringConstant {\n    nothing = '',\n    build = 'build',\n    vamtiger = 'vamtiger',\n    slash = '/',\n    jsExtension = '.js',\n    bashAnd = '&&',\n    arn = 'arn',\n    sns = 'sns',\n    aws = 'aws',\n    colon = ':',\n    hyphen = '-',\n    'vamtiger-contact' = 'vamtiger-contact',\n    '5e5164d3' = '5e5164d3',\n    cc71 = 'cc71',\n    '4e5b' = '4e5b',\n    '9c34' = '9c34',\n    '042fe735f31c' = '042fe735f31c'\n}\n\nexport enum Region {\n    usWest2= 'us-west-2'\n}\n\nexport enum ElmentName {\n    meta = 'meta',\n    script = 'script'\n}\n\nexport enum ElementId {\n    vamtigerBrowserSupport = 'vamtiger-browser-support'\n}\n\nexport enum ElementAttribute {\n    id = 'id'\n}\n\nexport enum MetaElementAttribute {\n    baseUrl = 'baseUrl',\n    name = 'name',\n    url = 'url',\n    primary = 'primary',\n    loaded = 'loaded',\n    supported = 'supported',\n    unsupported = 'unsupported',\n    error = 'error',\n    polyfill = 'polyfill',\n    loadCritical = 'loadCritical',\n    load = 'load',\n    wait = 'wait'\n}\n\nexport enum MetaElementBrowserSupportAttribute {\n    botSupport = 'data-bot-support',\n    es2015Support = 'data-es2015-support',\n    elementQuerySupport = 'data-element-query-support',\n    webComponentSupport = 'data-web-component-support',\n    fetchSupport = 'data-fetch-support',\n    awsSupport = 'data-aws-support',\n    contactSupport = 'data-contact-support'\n}\n\nexport enum Selector {\n    vamtigerBrowserSupportScript = 'script[src*=\"vamtiger-browser-support\"]',\n    vamtigerBrowserMethodJsonJs = '[src$=\"vamtiger-browser-method.js.json.js\"]',\n    vamtigerBrowserMethodJson = '[data-name$=\"vamtiger-browser-method.js.json\"]'\n}\n\nexport enum ScriptUrl {\n    vamtigerBrowserMethod = 'https://cdn.jsdelivr.net/npm/vamtiger-browser-method@latest/build/vamtiger-browser-method.js',\n    vamtigerBrowserMethodJsonJs = 'https://cdn.jsdelivr.net/npm/vamtiger-browser-method@latest/build/vamtiger-browser-method.js.json.js'\n}\n\nexport enum ErrorMessage {\n    notBrowser = 'This is not a web browser',\n    noFormForSelector = 'No Form for Selector',\n    noFieldInFormForSelector = 'No Field in Form for Selector'\n}\n\nexport enum NpmScript {\n    bundleSource = 'bundle-source'\n}\n\nexport enum SupportType {\n    primary = 'primary',\n    secondary = 'secondary'\n}\n\nexport enum LoadOnComplete {\n    loadCritical = 'loadCritical',\n    load = 'load'\n}\n\nexport enum VamtigerFormDataSupportFormFieldValue {\n    innerHTML = 'innerHTML'\n}\n\nexport enum DocumentDataAttribute {\n    touchSupport = 'vamtigerTouchSupport'\n}\n\nexport enum SupportFile {\n    elementQuery = 'vamtiger-element-query-support'\n}\n\nexport enum Polyfill {\n    elementQuery = 'https://cdn.jsdelivr.net/npm/eqcss@latest/EQCSS.min.js'\n}\n\nexport type LoadOnCompleteType  = keyof typeof LoadOnComplete;\n\nexport type Support = keyof typeof MetaElementBrowserSupportAttribute;\n\nexport type SupportTypeKey = keyof typeof SupportType;\n\nexport type StringObject = {[key: string]: string};\n\nexport type AnyObject = {[key: string]: any};\n\nexport type VamtigerSupportFile = 'vamtiger-es2015-support';\n\nexport type VamtigerFormDataSupportFormFieldValueKey = keyof typeof VamtigerFormDataSupportFormFieldValue;\n\nexport type VamtigerSupport =  {\n    [K in VamtigerSupportFile]?: IUpdateBrowserSupport;\n}\n\nexport type VamtigerContactResolve = (response: AWS.SNS.PublishResponse) => void;\n\nexport type VamtigerContactReject = (error: AWS.AWSError) => void;\n\nexport interface ISetBrowserSupportMetaElement {\n    support: Support;\n    primary?: boolean;\n}\n\nexport interface IUpdateBrowserSupport {\n    supportFile: string;\n    supported?: boolean;\n    polyfill?: string;\n    polyfills?: string[];\n    polyfillChain?: string[][]\n    wait?: boolean;\n    error?: string;\n}\n\nexport interface IUpdateBrowserSupportLoadScripts {\n    polyfills: IUpdateBrowserSupport['polyfills'];\n}\n\nexport interface IGetSupportUrls {\n    supportType: SupportType;\n}\n\nexport interface ILoadNextSupport {\n    supportType: SupportType;\n}\n\nexport interface IVamtigerContactParams {\n    template: string;\n    subject: string;\n    origin: string;\n}\n\nexport interface IVamtigerFormSupport {\n    form: string;\n    field?: IVamtigerFormSupportFormField;\n}\n\nexport interface IVamtigerFormSupportFormField {\n    selector: string;\n    name: string;\n    value?: VamtigerFormDataSupportFormFieldValueKey;\n}\n\ndeclare global {\n    interface Window extends VamtigerSupport {\n        [ElementId.vamtigerBrowserSupport]: HTMLMetaElement,\n        VamtigerBrowserSupport: (params: IUpdateBrowserSupport) => void;\n        VamtigerContact: (params: IVamtigerContactParams) => Promise<AWS.SNS.PublishResponse>;\n        _VamtigerContact_: (params: any) => void;\n        VamtigerForm: (params: IVamtigerFormSupport) => Promise<AnyObject>;\n        AWS: typeof AWS;\n    }\n}\n\nexport const supportTypes = Object.keys(SupportType) as SupportType[];\n\nexport const regex = {\n    leadingData: /^data/,\n    trailingSupport: /(.*?Support)(Primary)?$/,\n    supportScript: /vamtiger(-\\w+)+-(support|polyfill)/,\n    distTag: /(\\d|latest)$/,\n    bot: /bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex/i\n}\n\nexport const stringConstant = Object.assign(StringConstant, {\n    365080655670: 365080655670\n});\n\nexport const selector = {\n    vamtigerBrowserMethod: `script[src=\"${ScriptUrl.vamtigerBrowserMethod}\"]`\n}","import {\n    MetaElementBrowserSupportAttribute,\n    MetaElementAttribute,\n    Support ,\n    StringConstant,\n    StringObject,\n    regex,\n    SupportType,\n    LoadOnComplete,\n    LoadOnCompleteType,\n    stringConstant,\n    Region\n} from './types';\n\nconst { vamtiger, jsExtension } = StringConstant;\nconst { leadingData } = regex;\nconst supportKeys = Object.keys(MetaElementBrowserSupportAttribute) as Support[];\n\nexport const dependencies = [] as string[];\n\nexport const primarySupport = new Set<string>([\n    'botSupport',\n    'es2015Support'\n]);\n\nexport const supportScript: StringObject = Object.assign({} as StringObject, MetaElementBrowserSupportAttribute);\n\nexport const loadSupport = {\n    parallel: new Set([\n        SupportType.primary,\n        SupportType.secondary\n    ]),\n    series: new Set([\n\n    ])\n};\n\nexport const supportDone = Array.from(new Set([\n    MetaElementAttribute.supported,\n    MetaElementAttribute.unsupported\n]));\n\nexport const loadOnComplete = Array.from(new Set(\n    Object.keys(LoadOnComplete) as LoadOnCompleteType[]\n))\n\nexport const jsonFormatConfig = {\n    format: 'json'\n};\n\nexport const vc = gvc();\n\nsupportKeys.forEach(key => supportScript[key] = supportScript[key].replace(leadingData, vamtiger) + jsExtension);\n\nfunction gvc() {\n    const {\n        arn: a,\n        aws: b,\n        sns: c,\n        '365080655670': e,\n        'vamtiger-contact': f,\n        colon: g,\n        '5e5164d3': h,\n        cc71: i,\n        '4e5b': j,\n        '9c34': k,\n        '042fe735f31c': l,\n        hyphen: m\n    } = stringConstant;\n    const { usWest2: d } = Region;\n    const z = [\n        a,\n        b,\n        c,\n        d,\n        e,\n        f\n    ].join(g)\n    const x = [\n        d,\n        [\n            h,\n            i,\n            j,\n            k,\n            l\n        ].join(m)\n    ].join(g);\n    const y = {\n        z: Array.from(z),\n        x: Array.from(x),\n        y: Array.from(d)\n    };\n\n    return y;\n}","import { IVamtigerContactParams, VamtigerContactResolve, VamtigerContactReject } from './types';\nimport { vc } from './config';\n\nconst { AWS, _VamtigerContact_: gvc, VamtigerContact } = window;\nconst { config, SNS, CognitoIdentityCredentials: Credentials } = AWS;\nconst { origin, href } = location;\nconst { stringify } = JSON;\nconst { x, y, z} = gvc(vc) as any;\nconst Subject = `Vamtiger contact: ${href}`;\nconst region = y;\nconst credentials = new Credentials({\n    IdentityPoolId: x\n});\n\nObject.assign(config, { region, credentials });\n\nconst sns = new SNS();\n\nfunction vamtigerContact({ subject, template }: IVamtigerContactParams, resolve: VamtigerContactResolve, reject: VamtigerContactReject) {\n    const Message = stringify({\n        subject,\n        template,\n        origin: href\n    });\n    const params = {\n        Message,\n        Subject,\n        TopicArn: z\n    };\n\n    sns.publish(params, (error, response) => error ? reject(error) : resolve(response));\n}\n\nif (!VamtigerContact) {\n    window.VamtigerContact = (params) => new Promise((resolve, reject) => vamtigerContact(params, resolve, reject));\n}"],"names":["gvc"],"mappings":"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"}