{"version":3,"file":"vamtiger-contact-polyfill.js","sources":["../source/types.ts","../source/config.ts","../source/vamtiger-contact-polyfill.ts"],"sourcesContent":["import * as AWS from 'aws-sdk';\n\nexport enum StringConstant {\n    nothing = '',\n    vamtiger = 'vamtiger',\n    slash = '/',\n    jsExtension = '.js',\n    bashAnd = '&&',\n    arn = 'arn',\n    sns = 'sns',\n    aws = 'aws',\n    colon = ':',\n    hyphen = '-',\n    'vamtiger-contact' = 'vamtiger-contact',\n    '5e5164d3' = '5e5164d3',\n    cc71 = 'cc71',\n    '4e5b' = '4e5b',\n    '9c34' = '9c34',\n    '042fe735f31c' = '042fe735f31c'\n}\n\nexport enum Region {\n    usWest2= 'us-west-2'\n}\n\nexport enum ElmentName {\n    meta = 'meta',\n    script = 'script'\n}\n\nexport enum ElementId {\n    vamtigerBrowserSupport = 'vamtiger-browser-support'\n}\n\nexport enum ElementAttribute {\n    id = 'id'\n}\n\nexport enum MetaElementAttribute {\n    baseUrl = 'baseUrl',\n    name = 'name',\n    url = 'url',\n    primary = 'primary',\n    loaded = 'loaded',\n    supported = 'supported',\n    unsupported = 'unsupported',\n    error = 'error',\n    polyfill = 'polyfill',\n    loadCritical = 'loadCritical',\n    load = 'load',\n    wait = 'wait'\n}\n\nexport enum MetaElementBrowserSupportAttribute {\n    es2015Support = 'data-es2015-support',\n    elementQuerySupport = 'data-element-query-support',\n    webComponentSupport = 'data-web-component-support',\n    fetchSupport = 'data-fetch-support',\n    awsSupport = 'data-aws-support',\n    contactSupport = 'data-contact-support'\n}\n\nexport enum Selector {\n    vamtigerBrowserSupportScript = 'script[src*=\"vamtiger-browser-support\"]'\n}\n\nexport enum ErrorMessage {\n    notBrowser = 'This is not a web browser'\n}\n\nexport enum NpmScript {\n    bundleSource = 'bundle-source'\n}\n\nexport enum SupportType {\n    primary = 'primary',\n    secondary = 'secondary'\n}\n\nexport enum LoadOnComplete {\n    loadCritical = 'loadCritical',\n    load = 'load'\n}\n\nexport type LoadOnCompleteType  = keyof typeof LoadOnComplete;\n\nexport type Support = keyof typeof MetaElementBrowserSupportAttribute;\n\nexport type SupportTypeKey = keyof typeof SupportType;\n\nexport type StringObject = {[key: string]: string};\n\nexport type AnyObject = {[key: string]: any};\n\nexport type VamtigerSupportFile = 'vamtiger-es2015-support';\n\nexport interface ISetBrowserSupportMetaElement {\n    support: Support;\n    primary?: boolean;\n}\n\nexport interface IUpdateBrowserSupport {\n    supportFile: string;\n    supported?: boolean;\n    polyfill?: string;\n    polyfills?: string[];\n    chain?: boolean;\n    wait?: boolean;\n    error?: string;\n}\n\nexport interface IUpdateBrowserSupportLoadScripts {\n    polyfills: string[];\n}\n\nexport interface IGetSupportUrls {\n    supportType: SupportType;\n}\n\nexport interface ILoadNextSupport {\n    supportType: SupportType;\n}\n\nexport interface IVamtigerContactParams {\n    template: string;\n    subject: string;\n    origin: string;\n}\n\nexport type VamtigerSupport =  {\n    [K in VamtigerSupportFile]?: IUpdateBrowserSupport;\n}\n\ndeclare global {\n    interface Window extends VamtigerSupport {\n        [ElementId.vamtigerBrowserSupport]: HTMLMetaElement,\n        VamtigerBrowserSupport: (params: IUpdateBrowserSupport) => void;\n        VamtigerContact: (params: IVamtigerContactParams) => Promise<AWS.SNS.PublishResponse>;\n        _VamtigerContact_: (params: any) => void;\n        AWS: typeof AWS;\n    }\n}\n\nexport const supportTypes = Object.keys(SupportType) as SupportType[];\n\nexport const regex = {\n    leadingData: /^data/,\n    trailingSupport: /(.*?Support)(Primary)?$/,\n    supportScript: /vamtiger(-\\w+)+-(support|polyfill)/\n}\n\nexport const stringConstant = Object.assign(StringConstant, {\n    365080655670: 365080655670\n});","import {\n    MetaElementBrowserSupportAttribute,\n    MetaElementAttribute,\n    Support ,\n    StringConstant,\n    StringObject,\n    regex,\n    SupportType,\n    LoadOnComplete,\n    LoadOnCompleteType,\n    stringConstant,\n    Region\n} from './types';\n\nconst { vamtiger, jsExtension } = StringConstant;\nconst { leadingData } = regex;\nconst supportKeys = Object.keys(MetaElementBrowserSupportAttribute) as Support[];\n\nexport const primarySupport = new Set<string>([\n    'es2015Support'\n]);\n\nexport const supportScript: StringObject = Object.assign({} as StringObject, MetaElementBrowserSupportAttribute);\n\nexport const loadSupport = {\n    parallel: new Set([\n        SupportType.primary,\n        SupportType.secondary\n    ]),\n    series: new Set([\n\n    ])\n};\n\nexport const supportDone = Array.from(new Set([\n    MetaElementAttribute.supported,\n    MetaElementAttribute.unsupported\n]));\n\nexport const loadOnComplete = Array.from(new Set(\n    Object.keys(LoadOnComplete) as LoadOnCompleteType[]\n))\n\nexport const jsonFormatConfig = {\n    format: 'json'\n};\n\nexport const vc = gvc();\n\nsupportKeys.forEach(key => supportScript[key] = supportScript[key].replace(leadingData, vamtiger) + jsExtension);\n\nfunction gvc() {\n    const {\n        arn: a,\n        aws: b,\n        sns: c,\n        '365080655670': e,\n        'vamtiger-contact': f,\n        colon: g,\n        '5e5164d3': h,\n        cc71: i,\n        '4e5b': j,\n        '9c34': k,\n        '042fe735f31c': l,\n        hyphen: m\n    } = stringConstant;\n    const { usWest2: d } = Region;\n    const z = [\n        a,\n        b,\n        c,\n        d,\n        e,\n        f\n    ].join(g)\n    const x = [\n        d,\n        [\n            h,\n            i,\n            j,\n            k,\n            l\n        ].join(m)\n    ].join(g);\n    const y = {\n        z: Array.from(z),\n        x: Array.from(x),\n        y: Array.from(d)\n    };\n\n    return y;\n}","import { IVamtigerContactParams } from './types';\nimport { vc } from './config';\n\nconst { AWS, _VamtigerContact_: gvc } = window;\nconst { config, SNS, CognitoIdentityCredentials: Credentials } = AWS;\nconst { origin, href } = location;\nconst { stringify } = JSON;\nconst { x, y, z} = gvc(vc) as any;\nconst Subject = `Vamtiger contact: ${href}`;\nconst region = y;\nconst credentials = new Credentials({\n    IdentityPoolId: x\n});\n\nObject.assign(config, { region, credentials });\n\nconst sns = new SNS();\n\nwindow.VamtigerContact = ({ subject, template }: IVamtigerContactParams) => new Promise((resolve, reject) => {\n    const Message = stringify({\n        subject,\n        template,\n        origin: href\n    });\n    const params = {\n        Message,\n        Subject,\n        TopicArn: z\n    };\n\n    sns.publish(params, (error, response) => error ? reject(error) : resolve(response));\n});"],"names":["StringConstant","Region","ElmentName","ElementId","ElementAttribute","MetaElementAttribute","MetaElementBrowserSupportAttribute","Selector","ErrorMessage","NpmScript","SupportType","LoadOnComplete","stringConstant","Object","assign","365080655670","vamtiger","jsExtension","leadingData","supportKeys","keys","supportScript","vc","Set","primary","secondary","Array","from","supported","unsupported","a","b","c","e","f","g","h","i","j","k","l","m","d","z","join","x","y","gvc","forEach","key","replace","AWS","config","SNS","Credentials","href","stringify","_a","Subject","region","credentials","IdentityPoolId","sns","window","VamtigerContact","subject","template","Promise","resolve","reject","params","Message","origin","TopicArn","publish","error","response"],"mappings":"yBAEA,IAAYA,EAmBAC,EAIAC,EAKAC,EAIAC,EAIAC,EAeAC,EASAC,EAIAC,EAIAC,EAIAC,EAKAC,GA7EZ,SAAYX,GACRA,aACAA,sBACAA,YACAA,oBACAA,eACAA,YACAA,YACAA,YACAA,YACAA,aACAA,yCACAA,yBACAA,cACAA,iBACAA,iBACAA,iCAhBJ,CAAYA,IAAAA,OAmBZ,SAAYC,GACRA,sBADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,cACAA,kBAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,oDADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,UADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,oBACAA,cACAA,YACAA,oBACAA,kBACAA,wBACAA,4BACAA,gBACAA,sBACAA,8BACAA,cACAA,cAZJ,CAAYA,IAAAA,OAeZ,SAAYC,GACRA,sCACAA,mDACAA,mDACAA,oCACAA,gCACAA,wCANJ,CAAYA,IAAAA,OASZ,SAAYC,GACRA,yEADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,yCADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,+BADJ,CAAYA,IAAAA,OAIZ,SAAYC,GACRA,oBACAA,wBAFJ,CAAYA,IAAAA,OAKZ,SAAYC,GACRA,8BACAA,cAFJ,CAAYA,IAAAA,OAgEZ,IAQaC,EAAiBC,OAAOC,OAAOd,GACxCe,aAAc,eC1IVC,aAAUC,gBACVC,EDmIS,QClIXC,EAAcN,OAAOO,KAAKd,GAMnBe,EAA8BR,OAAOC,UAA2BR,GAyBhEgB,GAtBC,IAAIC,KACVb,EAAYc,QACZd,EAAYe,YAER,IAAIF,QAKWG,MAAMC,KAAK,IAAIJ,KACtClB,EAAqBuB,UACrBvB,EAAqBwB,eAezB,WAEQ,IAAAC,QACAC,QACAC,QACAC,kBACAC,wBACAC,UACAC,gBACAC,SACAC,YACAC,YACAC,oBACAC,WAEIC,YACFC,GACFb,EACAC,EACAC,EACAU,EACAT,EACAC,GACFU,KAAKT,GACDU,GACFH,GAEIN,EACAC,EACAC,EACAC,EACAC,GACFI,KAAKH,IACTG,KAAKT,GAOP,OALIQ,EAAGjB,MAAMC,KAAKgB,GACdE,EAAGnB,MAAMC,KAAKkB,GACdC,EAAGpB,MAAMC,KAAKe,IAzCJK,IAElB5B,EAAY6B,QAAQ,SAAAC,GAAO,OAAA5B,EAAc4B,GAAO5B,EAAc4B,GAAKC,QAAQhC,EAAaF,GAAYC,IC9C5F,IAAAkC,aAAKJ,2BACLK,WAAQC,QAAKC,+BACLC,kCACRC,iBACFC,OAAEZ,MAAGC,MAAGH,MACRe,EAAU,qBAAqBH,EAC/BI,EAASb,EACTc,EAAc,IAAIN,GACpBO,eAAgBhB,IAGpBhC,OAAOC,OAAOsC,GAAUO,SAAQC,gBAEhC,IAAME,EAAM,IAAIT,EAEhBU,OAAOC,gBAAkB,SAACP,OAAEQ,YAASC,aAAuC,OAAA,IAAIC,QAAQ,SAACC,EAASC,GAC9F,IAKMC,GACFC,QANYf,GACZS,UACAC,WACAM,OAAQjB,IAIRG,UACAe,SAAU9B,GAGdmB,EAAIY,QAAQJ,EAAQ,SAACK,EAAOC,GAAa,OAAAD,EAAQN,EAAOM,GAASP,EAAQQ"}