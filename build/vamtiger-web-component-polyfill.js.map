{"version":3,"file":"vamtiger-web-component-polyfill.js","sources":["../source/types.ts","../source/get-root-path.ts","../source/vamtiger-web-component-support.ts","../source/vamtiger-web-component-polyfill.ts"],"sourcesContent":["import * as VamtigerBrowserMethodTypes from 'vamtiger-browser-method/build/types';\nimport * as AWS from 'aws-sdk';\n\nexport enum StringConstant {\n    nothing = '',\n    build = 'build',\n    vamtiger = 'vamtiger',\n    slash = '/',\n    jsExtension = '.js',\n    bashAnd = '&&',\n    arn = 'arn',\n    sns = 'sns',\n    aws = 'aws',\n    colon = ':',\n    hyphen = '-',\n    'vamtiger-contact' = 'vamtiger-contact',\n    '5e5164d3' = '5e5164d3',\n    cc71 = 'cc71',\n    '4e5b' = '4e5b',\n    '9c34' = '9c34',\n    '042fe735f31c' = '042fe735f31c'\n}\n\nexport enum Region {\n    usWest2= 'us-west-2'\n}\n\nexport enum ElmentName {\n    meta = 'meta',\n    script = 'script'\n}\n\nexport enum ElementId {\n    vamtigerBrowserSupport = 'vamtiger-browser-support'\n}\n\nexport enum ElementAttribute {\n    id = 'id'\n}\n\nexport enum MetaElementAttribute {\n    baseUrl = 'baseUrl',\n    name = 'name',\n    url = 'url',\n    primary = 'primary',\n    loaded = 'loaded',\n    supported = 'supported',\n    unsupported = 'unsupported',\n    error = 'error',\n    polyfill = 'polyfill',\n    loadCritical = 'loadCritical',\n    load = 'load',\n    wait = 'wait'\n}\n\nexport enum MetaElementBrowserSupportAttribute {\n    botSupport = 'data-bot-support',\n    es2015Support = 'data-es2015-support',\n    elementQuerySupport = 'data-element-query-support',\n    webComponentSupport = 'data-web-component-support',\n    fetchSupport = 'data-fetch-support',\n    awsSupport = 'data-aws-support',\n    contactSupport = 'data-contact-support'\n}\n\nexport enum Selector {\n    vamtigerBrowserSupportScript = 'script[src*=\"vamtiger-browser-support\"]',\n    vamtigerBrowserMethodJsonJs = '[src$=\"vamtiger-browser-method.js.json.js\"]',\n    vamtigerBrowserMethodJson = '[data-name$=\"vamtiger-browser-method.js.json\"]'\n}\n\nexport enum ScriptUrl {\n    vamtigerBrowserMethod = 'https://vamtiger-project.github.io/vamtiger-browser-method/build/vamtiger-browser-method.js',\n    vamtigerBrowserMethodJsonJs = 'https://vamtiger-project.github.io/vamtiger-browser-method/build/vamtiger-browser-method.js.json.js'\n}\n\nexport enum ErrorMessage {\n    notBrowser = 'This is not a web browser',\n    noFormForSelector = 'No Form for Selector',\n    noFieldInFormForSelector = 'No Field in Form for Selector',\n    objectAssignNotSupported = 'Object.assign is not supported',\n    arrayFromNotSupported = 'Array.from is not supported',\n    destructringAssignmentNotSupported = 'Destructuring Assignment is not supported',\n    arrowFunctionsNotSupported = 'Arrow functions are not supported'\n}\n\nexport enum NpmScript {\n    bundleSource = 'bundle-source'\n}\n\nexport enum SupportType {\n    primary = 'primary',\n    secondary = 'secondary'\n}\n\nexport enum LoadOnComplete {\n    loadCritical = 'loadCritical',\n    load = 'load'\n}\n\nexport enum VamtigerFormDataSupportFormFieldValue {\n    innerHTML = 'innerHTML'\n}\n\nexport enum DocumentDataAttribute {\n    touchSupport = 'vamtigerTouchSupport',\n    isBot = 'vamtigerIsBot',\n    legacy = 'vamtigerLegacy',\n    textMode = 'vamtigerTextMode'\n}\n\nexport enum SupportFile {\n    elementQuery = 'vamtiger-element-query-support'\n}\n\nexport enum Polyfill {\n    elementQuery = 'https://cdn.jsdelivr.net/npm/eqcss@latest/EQCSS.min.js'\n}\n\nexport type LoadOnCompleteType  = keyof typeof LoadOnComplete;\n\nexport type Support = keyof typeof MetaElementBrowserSupportAttribute;\n\nexport type SupportTypeKey = keyof typeof SupportType;\n\nexport type StringObject = {[key: string]: string};\n\nexport type AnyObject = {[key: string]: any};\n\nexport type VamtigerSupportFile = 'vamtiger-es2015-support';\n\nexport type VamtigerFormDataSupportFormFieldValueKey = keyof typeof VamtigerFormDataSupportFormFieldValue;\n\nexport type VamtigerSupport =  {\n    [K in VamtigerSupportFile]?: IUpdateBrowserSupport;\n}\n\nexport type VamtigerContactResolve = (response: AWS.SNS.PublishResponse) => void;\n\nexport type VamtigerContactReject = (error: AWS.AWSError) => void;\n\nexport interface ISetBrowserSupportMetaElement {\n    support: Support;\n    primary?: boolean;\n}\n\nexport interface IUpdateBrowserSupport {\n    supportFile: string;\n    supported?: boolean;\n    polyfill?: string;\n    polyfills?: string[];\n    polyfillChain?: string[][]\n    wait?: boolean;\n    error?: string;\n}\n\nexport interface IUpdateBrowserSupportLoadScripts {\n    polyfills: IUpdateBrowserSupport['polyfills'];\n}\n\nexport interface IGetSupportUrls {\n    supportType: SupportType;\n}\n\nexport interface ILoadNextSupport {\n    supportType: SupportType;\n}\n\nexport interface IVamtigerContactParams {\n    template: string;\n    subject: string;\n    origin: string;\n}\n\nexport interface IVamtigerFormSupport {\n    form: string;\n    field?: IVamtigerFormSupportFormField;\n}\n\nexport interface IVamtigerFormSupportFormField {\n    selector: string;\n    name: string;\n    value?: VamtigerFormDataSupportFormFieldValueKey;\n}\n\ndeclare global {\n    interface Window extends VamtigerSupport {\n        [ElementId.vamtigerBrowserSupport]: HTMLMetaElement,\n        VamtigerBrowserSupport: (params: IUpdateBrowserSupport) => void;\n        VamtigerContact: (params: IVamtigerContactParams) => Promise<AWS.SNS.PublishResponse>;\n        _VamtigerContact_: (params: any) => void;\n        VamtigerForm: (params: IVamtigerFormSupport) => Promise<AnyObject>;\n        AWS: typeof AWS;\n    }\n}\n\nexport const supportTypes = Object.keys(SupportType) as SupportType[];\n\nexport const regex = {\n    leadingData: /^data/,\n    trailingSupport: /(.*?Support)(Primary)?$/,\n    supportScript: /vamtiger(-\\w+)+-(support|polyfill)/,\n    distTag: /(\\d|latest)$/,\n    bot: /bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex|googlebot|google-structured-data-testing-tool|bingbot|linkedinbot|mediapartners-google/i\n}\n\nexport const stringConstant = {\n    ...StringConstant,\n    365080655670: 365080655670\n};\n\nexport const selector = {\n    vamtigerBrowserMethod: `script[src=\"${ScriptUrl.vamtigerBrowserMethod}\"]`\n}","import { Selector, StringConstant } from './types';\n\nconst { slash, nothing } = StringConstant;\n\nlet rootPath: string;\n\nfunction generateRootPath() {\n    const { head, body} = document;\n    const { vamtigerBrowserSupportScript: selector } = Selector;\n    const vamtigerBrowserSupportScript = head.querySelector<HTMLScriptElement>(selector)\n        || body.querySelector<HTMLScriptElement>(selector);\n    const { pathname, origin } = new URL(vamtigerBrowserSupportScript.src);\n    const paths = pathname\n        .split(slash)\n        .filter(path => path.trim())\n        .filter((path, index, paths) => index < paths.length - 1);\n    const currentRootPath = [origin]\n        .concat(paths)\n        .join(slash);\n\n    rootPath = currentRootPath;\n\n    return currentRootPath;\n}\n\nfunction getRootPath() {\n    rootPath = rootPath || generateRootPath();\n\n    return rootPath;\n};\n\nexport default getRootPath;","import { IUpdateBrowserSupport, Selector } from './types';\nimport getRootPath from './get-root-path';\n\nconst rootPath = getRootPath();\nexport const supportFile = 'vamtiger-web-component-support';\nexport const polyfill = `${rootPath}/vamtiger-web-component-polyfill.js`;\n\nconst { VamtigerBrowserSupport } = window;\nconst params = {\n    supportFile\n} as IUpdateBrowserSupport;\nconst webComponent = `\nconst shadowDomTemplate = document.createElement('template');\n\nshadowDomTemplate.innerHTML = \\`\n<style>\n    .container {\n        border: 1px solid red;\n    }\n</style>\n\n<div class=\"container\">\n    <slot name=\"test-slot-1\"></slot>\n    <span>\n            VAMTIGER Browser Support\n    </span>\n    <slot name=\"test-slot-2\"></slot>\n</div>\n\\`\n\nclass VamtigerWebComponentSupport extends HTMLElement {\n    static get observedAttributes() {\n        const observedAttributes = [\n            'data-${supportFile}'\n        ];\n\n        return observedAttributes;\n    }\n\n    constructor() {\n        super();\n        const template = shadowDomTemplate.content.cloneNode(true);\n        const shadowRoot = this.attachShadow({mode: 'open'});\n\n        shadowRoot.appendChild(template);\n    }\n\n    connectedCallback() {\n        this.dataset['vamtigerWebComponentSupportConnectedCallback'] = '';\n    }\n\n    disconnectedCallback() {\n        this.dataset['vamtigerWebComponentSupportDisconnectedCallback'] = '';\n    }\n\n    attributeChangedCallback(attrName, oldValue, newValue) {\n        this.dataset['vamtigerWebComponentSupportOldValue'] = oldValue;\n        this.dataset['vamtigerWebComponentSupportNewValue'] = newValue;\n\n        this.dataset['vamtigerWebComponentSupportAttributeChangedCallback'] = '';\n    }\n}\n\ncustomElements.define('${supportFile}', VamtigerWebComponentSupport);\n`;\n\nfunction test() {\n    const { body } = document;\n    const customElement = document.createElement(supportFile);\n\n    let result = false;\n\n    customElement.innerHTML = `\n        <span slot=\"test-slot-1\">\n            Test Slot 1\n        </span>\n        <span>\n            No slot defined\n        </span>\n\n        <span slot=\"test-slot-2\">\n            Test Slot 2\n        </span>\n    `;\n\n    customElement.dataset['vamtigerWebComponentSupport'] = 'old-value';\n\n    body.appendChild(customElement);\n\n    customElement.dataset['vamtigerWebComponentSupport'] = 'new-value';\n\n    body.removeChild(customElement);\n\n    result = customElement.dataset.hasOwnProperty('vamtigerWebComponentSupportConnectedCallback')\n        && customElement.dataset.hasOwnProperty('vamtigerWebComponentSupportDisconnectedCallback')\n        && customElement.dataset['vamtigerWebComponentSupportOldValue'] === 'old-value'\n        && customElement.dataset['vamtigerWebComponentSupportNewValue'] === customElement.dataset['vamtigerWebComponentSupport']\n        && customElement.shadowRoot.children.length === 2\n        && window.hasOwnProperty('HTMLTemplateElement')\n        && window.hasOwnProperty('HTMLSlotElement')\n        && !!HTMLElement.prototype.attachShadow;\n\n    return result;\n}\n\ntry {\n    eval(webComponent);\n\n    params.supported = test();\n} catch(error) {\n    params.error = error;\n}\n\nif (!params.supported) {\n    params.polyfill = polyfill;\n    params.wait = true;\n}\n\nVamtigerBrowserSupport(params);","import { supportFile } from './vamtiger-web-component-support';\nimport { IUpdateBrowserSupport } from './types';\n\nconst params = { supportFile } as IUpdateBrowserSupport;\nconst polyfill = 'https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/webcomponents-bundle.js';\n\naddEventListener('WebComponentsReady', handleWebComponentsReady);\n\nmain().catch(handleError);\n\nasync function main() {\n    const { VamtigerBrowserMethod } = window;\n    const { loadScript } = VamtigerBrowserMethod;\n\n    await loadScript({ src: polyfill });\n}\n\nfunction handleWebComponentsReady() {\n    const { VamtigerBrowserSupport } = window;\n\n    removeEventListener('WebComponentsReady', handleWebComponentsReady);\n\n    VamtigerBrowserSupport(params);\n}\n\nfunction handleError(error: Error) {\n    const { VamtigerBrowserSupport } = window;\n\n    params.error = error.message;\n\n    VamtigerBrowserSupport(params);\n}"],"names":["StringConstant","Region","ElmentName","ElementId","ElementAttribute","MetaElementAttribute","MetaElementBrowserSupportAttribute","Selector","ScriptUrl","ErrorMessage","NpmScript","SupportType","LoadOnComplete","VamtigerFormDataSupportFormFieldValue","DocumentDataAttribute","SupportFile","Polyfill","stringConstant","365080655670","selector","vamtigerBrowserMethod","slash","nothing","rootPath","generateRootPath","head","body","vamtigerBrowserSupportScript","querySelector","_a","pathname","origin","paths","split","filter","path","trim","index","length","currentRootPath","concat","join","getRootPath","supportFile","polyfill","VamtigerBrowserSupport","params","webComponent","test","customElement","document","createElement","innerHTML","dataset","appendChild","removeChild","hasOwnProperty","shadowRoot","children","window","HTMLElement","prototype","attachShadow","eval","supported","error","wait","main","VamtigerBrowserMethod","loadScript","src","handleWebComponentsReady","removeEventListener","handleError","message","addEventListener","catch"],"mappings":"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"}